<%- include('partials/header') %>

<div class="container py-5 min-vh-100 fav">
  <div class="text-center mb-5">
    <h1 class="display-4 fw-bold text-danger fav__title">
      Món Ẩm Thực Yêu Thích
    </h1>
    <p class="lead text-muted fav__subtitle">
      Những công thức bạn đã lưu để nấu sau này
    </p>
  </div>

  <!-- Nếu chưa có món yêu thích -->
  <% if (!favorites || favorites.length === 0) { %>
  <div class="text-center py-5 my-5 fav__empty">
    <img
      src="https://i.imgur.com/8QdZ4Zm.png"
      alt="Chưa có món yêu thích"
      width="180"
      class="mb-4 opacity-50"
    />
    <h3 class="text-muted fw-light">Bạn chưa lưu món nào</h3>
    <p class="text-muted lead">
      Hãy khám phá và nhấn <i class="fas fa-heart text-danger"></i> để lưu lại
      những món ngon!
    </p>
    <a href="/" class="btn btn-danger btn-lg rounded-pill px-5 shadow mt-3">
      <i class="fas fa-search me-2"></i> Tìm món ngay
    </a>
  </div>
  <% } else { %>

  <!-- Danh sách món yêu thích -->
  <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-5 fav__grid">
    <% favorites.forEach(recipe => { %>
    <div class="col">
      <div
        class="card recipe-card h-100 border-0 shadow-lg rounded-4 overflow-hidden position-relative fav__card"
      >
        <!-- Ảnh món -->
        <div class="position-relative overflow-hidden">
          <% const img = recipe.image ? (recipe.image.startsWith('http') ?
          recipe.image : '/' + recipe.image.replace(/^\/+/, '')) :
          `https://source.unsplash.com/600x400/?vietnamese-food,${encodeURIComponent(recipe.title)}`;
          %>
          <img
            src="<%= img %>"
            alt="<%= recipe.title %>"
            class="card-img-top recipe-card-img"
            onerror="this.src='https://images.unsplash.com/photo-1504674900247-0877df9cc836?ixlib=rb-4.0.3&auto=format&fit=crop&q=80'"
          />
          <div class="position-absolute top-0 end-0 p-3">
            <span class="badge bg-danger fs-6 shadow">
              <i class="fas fa-heart"></i> Yêu thích
            </span>
          </div>
        </div>

        <div class="card-body d-flex flex-column p-4">
          <h5 class="card-title fw-bold text-danger fs-4 mb-2 line-clamp-2">
            <%= recipe.title %>
          </h5>
          <p class="text-muted small mb-3">
            <i class="fas fa-user-circle text-danger me-1"></i>
            bởi <strong><%= recipe.username || 'Ẩn danh' %></strong>
          </p>
          <% if (recipe.description) { %>
          <p class="text-secondary flex-grow-1 line-clamp-3 mb-3">
            <%= recipe.description %>
          </p>
          <% } %>

          <div class="mt-auto d-flex gap-2 fav__actions">
            <a
              href="/recipes/<%= recipe.id %>"
              class="btn btn-danger rounded-pill flex-fill"
            >
              <i class="fas fa-book-open me-1"></i> Xem
            </a>
            <form
              action="/recipes/<%= recipe.id %>/unfavorite"
              method="POST"
              class="d-inline"
            >
              <button type="submit" class="btn btn-outline-danger rounded-pill">
                <i class="fas fa-heart-broken"></i>
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>
    <% }) %>
  </div>
  <% } %>
</div>

<%- include('partials/footer') %>
