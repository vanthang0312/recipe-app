<%- include('./partials/header') %>

<div class="admin-hero mb-4">
  <div>
    <p class="text-light mb-1">Admin / Quản lý tài khoản</p>
    <h1 class="text-white fw-bold">Tài khoản</h1>
    <p class="text-light mb-0">Thêm, sửa, xóa hoặc khóa/mở khóa người dùng.</p>
  </div>
  <div class="d-flex gap-2">
    <a href="/admin/users/add" class="btn btn-light btn-sm">
      <i class="fas fa-user-plus me-1"></i>Thêm tài khoản
    </a>
  </div>
</div>

<div class="card border-0 shadow-lg rounded-4">
  <div class="card-body">
    <div class="table-responsive">
      <table class="table table-hover align-middle">
        <thead class="table-light">
          <tr>
            <th>ID</th>
            <th>Tên đăng nhập</th>
            <th>Email</th>
            <th>Vai trò</th>
            <th>Buộc đổi MK</th>
            <th>Ngày tạo</th>
            <th>Hành động</th>
          </tr>
        </thead>
        <tbody>
          <% users.forEach(u => { %>
          <tr>
            <td><%= u.id %></td>
            <td><%= u.username %></td>
            <td><%= u.email || '---' %></td>
            <td>
              <span class="badge bg-<%= u.role === 'admin' ? 'danger' : (u.role === 'banned' ? 'secondary' : 'success') %>">
                <%= u.role %>
              </span>
            </td>
            <td><%= u.must_change ? 'Có' : 'Không' %></td>
            <td><%= u.created_at ? new Date(u.created_at).toLocaleDateString('vi-VN') : '---' %></td>
            <td class="d-flex flex-wrap gap-1">
              <a href="/admin/users/<%= u.id %>/edit" class="btn btn-warning btn-sm rounded-pill px-3">
                <i class="fas fa-edit me-1"></i>Sửa
              </a>
              <form method="POST" action="/admin/users/<%= u.id %>/delete" onsubmit="return confirm('Xóa tài khoản này?')">
                <button type="submit" class="btn btn-danger btn-sm rounded-pill px-3">
                  <i class="fas fa-trash me-1"></i>Xóa
                </button>
              </form>
              <form method="POST" action="/admin/user/toggle/<%= u.id %>">
                <button type="submit" class="btn btn-outline-secondary btn-sm rounded-pill px-3">
                  <i class="fas fa-ban me-1"></i><%= u.role === 'banned' ? 'Mở khóa' : 'Khóa' %>
                </button>
              </form>
              <form method="POST" action="/admin/user/role/<%= u.id %>">
                <button type="submit" class="btn btn-outline-primary btn-sm rounded-pill px-3">
                  <i class="fas fa-user-shield me-1"></i><%= u.role === 'admin' ? 'Chuyển user' : 'Chuyển admin' %>
                </button>
              </form>
            </td>
          </tr>
          <% }) %>
        </tbody>
      </table>
    </div>
  </div>
</div>

<%- include('./partials/footer') %>
